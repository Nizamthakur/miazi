<!DOCTYPE html>
<html lang="en">
<head>
    <title>Home</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Load static files -->
    {% load static %}
    <!--===============================================================================================-->
    <link rel="icon" type="image/png" href="{% static 'images/icons/favicon.png' %}"/>
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="{% static 'fonts/font-awesome-4.7.0/css/font-awesome.min.css' %}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="{% static 'fonts/iconic/css/material-design-iconic-font.min.css' %}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="{% static 'fonts/linearicons-v1.0.0/icon-font.min.css' %}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/animate/animate.css' %}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/css-hamburgers/hamburgers.min.css' %}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/animsition/css/animsition.min.css' %}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/select2/select2.min.css' %}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/daterangepicker/daterangepicker.css' %}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/slick/slick.css' %}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/MagnificPopup/magnific-popup.css' %}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/perfect-scrollbar/perfect-scrollbar.css' %}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="{% static 'css/util.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
    <!--===============================================================================================-->
<!-- Facebook Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1370732264288445');
    fbq('track', 'PageView');
    </script>
    <noscript>
    <img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1370732264288445&ev=PageView&noscript=1"/>
    </noscript>
    <!-- End Facebook Meta Pixel Code -->
</head>
<body class="animsition">

   <!-- Header -->
    <header>
        <!-- Header desktop -->
        <div class="container-menu-desktop">
            <!-- Topbar -->


            <div class="wrap-menu-desktop">
                <nav class="limiter-menu-desktop container">

                    <!-- Logo desktop -->
                    <a href="{% url 'home' %}" class="logo" style="margin-top:20px;">
                        <img src="{% static 'images/icons/logo1.png' %}" alt="IMG-LOGO">
                    </a>

                    <!-- Menu desktop -->
                    <div class="menu-desktop">
                        <ul class="main-menu">
                            <li class="active-menu">
                                <a href="{% url 'home' %}">Home</a>
                            </li>
                            <li>
                                <a href="{% url 'product_view' %}">Shop</a>
                            </li>

                            <li class="label1" data-label1="hot">
                                <a href="{% url 'featured_products' %}">Features</a>
                            </li>

<!--                            <li>-->
<!--                                <a href="blog.html">Blog</a>-->
<!--                            </li>-->

<!--                            <li>-->
<!--                                <a href="about.html">About</a>-->
<!--                            </li>-->

                            <li>
                                <a href="{% url 'contact' %}">Contact</a>
                            </li>
                        </ul>
                    </div>

                    <!-- Icon header -->
                    <div class="wrap-icon-header flex-w flex-r-m">
                        <div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 js-show-modal-search">
                            <i class="zmdi zmdi-search"></i>
                        </div>

                        <div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti js-show-cart" data-notify="2">
                            <i class="zmdi zmdi-shopping-cart"></i>
                        </div>

                        <a href="{% url 'wishlist' %}" class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti"
   data-notify="{% if request.user.is_authenticated %}{{ request.user.wishlist.products.count }}{% else %}0{% endif %}" id="wishlist-count">
    <i class="zmdi zmdi-favorite-outline"></i>
</a>
                    </div>
                </nav>
            </div>
        </div>

        <!-- Header Mobile -->
        <div class="wrap-header-mobile">
            <!-- Logo mobile -->
            <div class="logo-mobile">
                <a href="{% url 'home' %}"><img src="{% static 'images/icons/logo1.png' %}" alt="IMG-LOGO"></a>
            </div>

            <!-- Icon header -->
            <div class="wrap-icon-header flex-w flex-r-m m-r-15">
                <div class="icon-header-item cl2 hov-cl1 trans-04 p-r-11 js-show-modal-search">
                    <i class="zmdi zmdi-search"></i>
                </div>

                <div class="icon-header-item cl2 hov-cl1 trans-04 p-r-11 p-l-10 icon-header-noti js-show-cart" data-notify="2">
                    <i class="zmdi zmdi-shopping-cart"></i>
                </div>

                <a href="#" class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-r-11 p-l-10 icon-header-noti" data-notify="0">
                    <i class="zmdi zmdi-favorite-outline"></i>
                </a>
            </div>

            <!-- Button show menu -->
            <div class="btn-show-menu-mobile hamburger hamburger--squeeze">
                <span class="hamburger-box">
                    <span class="hamburger-inner"></span>
                </span>
            </div>
        </div>

        <!-- Menu Mobile -->
        <div class="menu-mobile">


            <ul class="main-menu-m">
                <li>
                    <a href="{% url 'home' %}">Home</a>
<!--                    <span class="arrow-main-menu-m">-->
<!--                        <i class="fa fa-angle-right" aria-hidden="true"></i>-->
<!--                    </span>-->
                </li>

                <li>
                    <a href="{% url 'product_view' %}">Shop</a>
                </li>

                <li>
                    <a href="{% url 'featured_products' %}" class="label1 rs1" data-label1="hot">Features</a>
                </li>

<!--                <li>-->
<!--                    <a href="blog.html">Blog</a>-->
<!--                </li>-->

<!--                <li>-->
<!--                    <a href="about.html">About</a>-->
<!--                </li>-->

                <li>
                    <a href="{% url 'contact' %}">Contact</a>
                </li>
            </ul>
        </div>

        <!-- Modal Search -->
        <div class="modal-search-header flex-c-m trans-04 js-hide-modal-search">
            <div class="container-search-header">
                <button class="flex-c-m btn-hide-modal-search trans-04 js-hide-modal-search">
                    <img src="{% static 'images/icons/icon-close2.png' %}" alt="CLOSE">
                </button>

                <form class="wrap-search-header flex-w p-l-15">
                    <button class="flex-c-m trans-04">
                        <i class="zmdi zmdi-search"></i>
                    </button>
                    <input class="plh3" type="text" name="search" placeholder="Search...">
                </form>
            </div>
        </div>
    </header>
    <!--wishlist-->
<section class="bg0 p-t-23 p-b-140"style="margin-top: 60px;">
    <div class="container">
        <div class="p-b-10">
            <h3 class="ltext-1033 cl55">
                My Wishlist ({{ wishlist.products.count }} items)
            </h3>
        </div>

        {% if wishlist.products.all %}
        <div class="row isotope-grid">
            {% for product in wishlist.products.all %}
            <div class="col-sm-6 col-md-4 col-lg-3 p-b-35 isotope-item {{ product.category.slug }}">
                <div class="block2">
                    <div class="block2-pic hov-img0">
                        <img src="{{ product.get_main_image_url }}" alt="{{ product.name }}" class="img-fluid"> <!-- Added img-fluid for responsiveness -->

                        <a href="#" class="block2-btn flex-c-m stext-103 cl2 size-102 bg0 bor2 hov-btn1 p-lr-15 trans-04 js-show-modal1"
                           data-product-id="{{ product.id }}">
                            Quick View
                        </a>
                    </div>

                    <div class="block2-txt flex-w flex-t p-t-14">
                        <div class="block2-txt-child1 flex-col-l">
                            <a href="#" class="stext-104 cl4 hov-cl1 trans-04 js-show-modal1 p-b-6"
                                   data-product-id="{{ product.id }}">
                                    {{ product.name }}
                                </a>
                            <span class="stext-105 cl3 sku-text mb-2">
                                SKU: {{ product.sku }}
                            </span>
                            <div class="flex-w">
                                {% if product.sale_price %}
                                <span class="stext-105 cl3" style="text-decoration: line-through;">
                                    ৳{{ product.price }}
                                </span>
                                <span class="stext-105 cl1 p-l-10">
                                    ৳{{ product.sale_price }}
                                </span>
                                {% else %}
                                <span class="stext-105 cl3">
                                    ৳{{ product.price }}
                                </span>
                                {% endif %}
                                <button class="btn-remove-wishlist flex-c-m stext-103 cl2 size-102 bg0 bor2 hov-btn1 p-lr-15 trans-04 mt-20px"
                                   data-product-id="{{ product.id }}">
                                    Remove from wishlist
                                </button>
                            </div>
                        </div>
                        <div class="block2-txt-child2 flex-r p-t-3">
                            <a href="#" class="btn-addwish-b2 dis-block pos-relative js-addwish-b2"
                               data-product-id="{{ product.id }}">
<!--                                <img class="icon-heart1 dis-block trans-04" src="{% static 'images/icons/icon-heart-01.png' %}" alt="ICON">-->
<!--                                <img class="icon-heart2 dis-block trans-04 ab-t-l" src="{% static 'images/icons/icon-heart-02.png' %}" alt="ICON">-->
                            </a>
                        </div>
                    </div>
                    <!-- In the product card div, add this section -->
                    <div class="flex-w flex-r-m p-b-10">
                        <div class="size-204 flex-w flex-m respon6-next">
                            <div class="wrap-num-product flex-w m-r-20 m-tb-10">
                                <div class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m">
                                    <i class="fs-16 zmdi zmdi-minus"></i>
                                </div>
                                <input class="mtext-104 cl3 txt-center num-product" type="number" name="num-product" value="1">
                                <div class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m">
                                    <i class="fs-16 zmdi zmdi-plus"></i>
                                </div>
                            </div>
                            <button class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04 js-addcart"
                                data-product-id="{{ product.id }}">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center p-t-50 p-b-50">
            <img src="{% static 'images/wishlist.png' %}" alt="Empty wishlist" class="m-b-20" style="max-width: 300px;">
            <p class="stext-102 cl6 p-b-20">Your wishlist is currently empty</p>
            <a href="{% url 'home' %}" class="stext-101 cl0 size-103 bg1 bor1 hov-btn1 p-lr-15 trans-04">
                Continue Shopping
            </a>
        </div>
        {% endif %}
    </div>
</section>
    <!--wishlist-->
 <!-- Footer -->
    <footer class="bg3 p-t-75 p-b-32">
        <div class="container">
            <div class="row">


                <div class="col-sm-6 col-lg-4 p-b-50">
                    <h4 class="stext-301 cl0 p-b-30">
                        Help Desk
                    </h4>

                    <ul>
                        <li class="p-b-10">
                            <a href="https://steadfast.com.bd/tracking" class="stext-107 cl7 hov-cl1 trans-04">
                                Track Order
                            </a>
                        </li>

                        <li class="p-b-10">
                            <a href="{% url 'return_policy' %}" class="stext-107 cl7 hov-cl1 trans-04">
                                Return policy
                            </a>
                        </li>

                        <li class="p-b-10">
                            <a href="{% url 'shipping_partners' %}" class="stext-107 cl7 hov-cl1 trans-04">
                                Shipping Partners
                            </a>
                        </li>
                        <li class="p-b-10">
                            <a href="{% url 'exchange_policy' %}" class="stext-107 cl7 hov-cl1 trans-04">
                                Exchange policy
                            </a>
                        </li>


                    </ul>
                </div>

                <div class="col-sm-6 col-lg-4 p-b-50">
                    <h4 class="stext-301 cl0 p-b-30">
                        GET IN TOUCH
                    </h4>

                    <p class="stext-107 cl7 size-201">
                        Any questions? Let us know in store at 192/A , Tilpapara, Khilgaon, Dhaka 1219 or call us on +8801707365693.
                    </p>

                   <div class="p-t-27">
                        <a href="https://www.facebook.com/profile.php?id=61572220262415" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
                            <i class="fa fa-facebook"></i>
                        </a>

                        <a href="https://www.instagram.com/miabaaba/" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
                            <i class="fa fa-instagram"></i>
                        </a>

                        <a href="https://wa.me/8801707365693?text=Hello%2C%20I%20have%20a%20question%20about%20your%20products%20of%20Miabaaba!" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
                            <i class="fa fa-whatsapp"></i> <!-- Added WhatsApp -->
                        </a>


                    </div>
                </div>

                <div class="col-sm-6 col-lg-4 p-b-50">
                    <h4 class="stext-301 cl0 p-b-30">
                        Newsletter
                    </h4>

                    <form>
                        <div class="wrap-input1 w-full p-b-4">
                            <input class="input1 bg-none plh1 stext-107 cl7" type="text" name="email" placeholder="email@example.com">
                            <div class="focus-input1 trans-04"></div>
                        </div>

                        <div class="p-t-18">
                            <button class="flex-c-m stext-101 cl0 size-103 bg1 bor1 hov-btn2 p-lr-15 trans-04">
                                Subscribe
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="p-t-40">
               <div class="flex-c-m flex-w p-b-18">
                <a href="#" class="m-all-1">
                    <img class="payment-logo" src="{% static 'images/icons/Bkash-Logo.svg' %}" alt="ICON-PAY">
                </a>

                <a href="#" class="m-all-1">
                    <img class="payment-logo" src="{% static 'images/icons/nagad.png' %}" alt="ICON-PAY">
                </a>

                <a href="#" class="m-all-1">
                    <img class="payment-logo" src="{% static 'images/icons/icon-pay-02.png' %}" alt="ICON-PAY">
                </a>

                <a href="#" class="m-all-1">
                    <img class="payment-logo" src="{% static 'images/icons/icon-pay-03.png' %}" alt="ICON-PAY">
                </a>

                <a href="#" class="m-all-1">
                    <img class="payment-logo" src="{% static 'images/icons/icon-pay-04.png' %}" alt="ICON-PAY">
                </a>

                <a href="#" class="m-all-1">
                    <img class="payment-logo" src="{% static 'images/icons/icon-pay-05.png' %}" alt="ICON-PAY">
                </a>
            </div>

                <p class="stext-107 cl6 txt-center">
                    Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | by <a href="https://teccmark.com" target="_blank">Miabaaba</a>
                </p>
            </div>
        </div>
    </footer>
 <!--===============================================================================================-->
<script src="{% static 'vendor/jquery/jquery-3.2.1.min.js' %}"></script>
<!--===============================================================================================-->
<script src="{% static 'vendor/animsition/js/animsition.min.js' %}"></script>
<!--===============================================================================================-->
<script src="{% static 'vendor/bootstrap/js/popper.js' %}"></script>
<script src="{% static 'vendor/bootstrap/js/bootstrap.min.js' %}"></script>
<!--===============================================================================================-->
<script src="{% static 'vendor/select2/select2.min.js' %}"></script>
<script>
    $(".js-select2").each(function(){
        $(this).select2({
            minimumResultsForSearch: 20,
            dropdownParent: $(this).next('.dropDownSelect2')
        });
    });
</script>
<!--===============================================================================================-->
<script src="{% static 'vendor/daterangepicker/moment.min.js' %}"></script>
<script src="{% static 'vendor/daterangepicker/daterangepicker.js' %}"></script>
<!--===============================================================================================-->
<script src="{% static 'vendor/slick/slick.min.js' %}"></script>
<script src="{% static 'js/slick-custom.js' %}"></script>
<!--===============================================================================================-->
<script src="{% static 'vendor/parallax100/parallax100.js' %}"></script>
<script>
    $('.parallax100').parallax100();
</script>
<!--===============================================================================================-->
<script src="{% static 'vendor/MagnificPopup/jquery.magnific-popup.min.js' %}"></script>
<script>
    $('.gallery-lb').each(function() {
        $(this).magnificPopup({
            delegate: 'a',
            type: 'image',
            gallery: {
                enabled: true
            },
            mainClass: 'mfp-fade'
        });
    });
</script>
<!--===============================================================================================-->
<script src="{% static 'vendor/isotope/isotope.pkgd.min.js' %}"></script>
<!--===============================================================================================-->
<script src="{% static 'vendor/sweetalert/sweetalert.min.js' %}"></script>
<script>
    // CSRF Cookie Function
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Wishlist Functionality
    document.querySelectorAll('.js-addwish-b2, .js-addwish-detail').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const productId = this.closest('[data-product-id]')?.dataset.productId;

            if(!productId) return;

            fetch(`/wishlist/add/${productId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            })
            .then(response => {
                if (response.status === 403) {
                    window.location.href = '/accounts/login/?next=' + encodeURIComponent(window.location.pathname);
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('wishlist-count').dataset.notify = data.count;
                swal('Added to wishlist!', '', 'success');
            })
            .catch(error => {
                swal('Please login first!', '', 'error');
            });
        });
    });

    // Remove from Wishlist
    document.querySelectorAll('.btn-remove-wishlist').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const productId = this.dataset.productId;

            fetch(`/wishlist/remove/${productId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    this.closest('.isotope-item').remove();
                    document.getElementById('wishlist-count').dataset.notify = data.count;
                    swal('Removed from wishlist!', '', 'success');
                    if(data.count === 0) window.location.reload();
                }
            })
            .catch(error => console.error('Error:', error));
        });
    });

    // Add to Cart Functionality
    document.querySelectorAll('.js-addcart, .js-addcart-detail').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const productId = this.dataset.productId;
            const quantityInput = this.closest('.flex-w')?.querySelector('.num-product');
            const quantity = quantityInput ? quantityInput.value : 1;

            fetch(`/cart/add/${productId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({quantity: quantity}),
                credentials: 'include'
            })
            .then(response => {
                if (response.status === 403) {
                    window.location.href = '/accounts/login/?next=' + encodeURIComponent(window.location.pathname);
                }
                return response.json();
            })
            .then(data => {
                if(data.success) {
                    document.querySelector('.js-show-cart').dataset.notify = data.cart_count;
                    swal('Added to cart!', '', 'success');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                swal('Error adding to cart!', '', 'error');
            });
        });
    });

    // Quick View Modal Handling
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.js-show-modal1').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const productId = this.dataset.productId;

                fetch(`/products/${productId}/quick-view/`)
                    .then(response => response.json())
                    .then(data => {
                        const quickViewContent = document.getElementById('quick-view-content');
                        quickViewContent.innerHTML = `
                            <!-- Your quick view content template here -->
                        `;
                        $('.js-modal1').addClass('show-modal1');
                    })
                    .catch(error => console.error('Error:', error));
            });
        });

        // Close Modal
        document.querySelectorAll('.js-hide-modal1').forEach(button => {
            button.addEventListener('click', function() {
                $('.js-modal1').removeClass('show-modal1');
            });
        });
    });
</script>
<!--===============================================================================================-->
<script src="{% static 'vendor/perfect-scrollbar/perfect-scrollbar.min.js' %}"></script>
<script>
    $('.js-pscroll').each(function(){
        $(this).css('position','relative');
        $(this).css('overflow','hidden');
        var ps = new PerfectScrollbar(this, {
            wheelSpeed: 1,
            scrollingThreshold: 1000,
            wheelPropagation: false,
        });

        $(window).on('resize', function(){
            ps.update();
        });
    });
</script>
<!--===============================================================================================-->
<script src="{% static 'js/main.js' %}"></script>
</body>
</html>